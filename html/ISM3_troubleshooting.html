<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WPAN Gateway: ISM3 Troubleshooting</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WPAN Gateway
   </div>
   <div id="projectbrief">A low-power border router</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="ISM3_manual.html">Using the ISM3 module</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ISM3 Troubleshooting </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Things don't always happen as planned and that is a normal part of development. There are a few standard steps one can take to identify problems.</p>
<h1><a class="anchor" id="autotoc_md56"></a>
Documents</h1>
<p><a href="RM1S3 Host Commands.pdf">ISM3 documentation</a></p>
<p><a href="schema_cm4.PDF">Pi CM4 board schematic</a></p>
<p><a href="RFShield_docs.PDF">Shield schematics and layout</a></p>
<h1><a class="anchor" id="autotoc_md57"></a>
Jumper setup</h1>
<p>There are a few jumpers to choose different configurations on the radio shield:</p><ul>
<li>X11: power source. Left: power from NUCLEO connector. Right: power from USB-C connector.</li>
<li>X17,X18,X22,X23: UART source. Left: USB-C UART. Right: UART from NUCLEO connector.</li>
<li>X1,X5: Power supply toggles. Left jumper closes power supply circuit. Right jumper closes power supply indicator LED circuit.</li>
<li>X24: Integrated STM32 chip BOOT0 pin. Boot partition selection. Do not bridge unless you know what you are doing. Contact nicolas.brunner@heig-vd for information.</li>
</ul>
<p>Reference configuration for use with CM4 is:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Side    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">X1   </td><td class="markdownTableBodyNone">On (vertical)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">X5   </td><td class="markdownTableBodyNone">On (vertical)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">X11   </td><td class="markdownTableBodyNone">Left    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">X17   </td><td class="markdownTableBodyNone">Right    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">X18   </td><td class="markdownTableBodyNone">Right    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">X22   </td><td class="markdownTableBodyNone">Right    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">X23   </td><td class="markdownTableBodyNone">Right    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">X24   </td><td class="markdownTableBodyNone">No jumper   </td></tr>
</table>
<p>This configuration is shown on radio module picture (<a class="el" href="hardware_setup.html">Hardware setup</a>).</p>
<h1><a class="anchor" id="autotoc_md58"></a>
Module power supply</h1>
<p>On the radio shield, check LEDs VCC1 and VCC_PA are lit up when jumpers X1, X5 are set. If not lit up, check jumper X11. Default setting is left for power coming from CM4 board.</p>
<h1><a class="anchor" id="autotoc_md59"></a>
UART troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md60"></a>
Check hardware connections</h2>
<p>Check jumpers X17, X18, X22, X23 are correctly set.</p>
<p>UART Jumper definitions:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Signal   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">X17   </td><td class="markdownTableBodyNone">CTS   </td><td class="markdownTableBodyNone">Clear to send    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">X18   </td><td class="markdownTableBodyNone">TX   </td><td class="markdownTableBodyNone">Transmit    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">X22   </td><td class="markdownTableBodyNone">RTS   </td><td class="markdownTableBodyNone">Request to send    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">X23   </td><td class="markdownTableBodyNone">RX   </td><td class="markdownTableBodyNone">Receive   </td></tr>
</table>
<p><a href="https://www.silabs.com/documents/public/application-notes/an0059.0-uart-flow-control.pdf">AN0059.0 from Silicon Labs</a> provides a good overview of these signals and their waveforms.</p>
<h2><a class="anchor" id="autotoc_md61"></a>
Check Linux serial</h2>
<p>The CM4 ISM3 driver uses serial port /dev/ttyAMA1 defined in <a class="el" href="hardware_8h.html#a41f90d423efcfe40e1702cb953f97c26" title="Linux hardware serial port.">UART_DEV</a>. Check that this device links to UART4 on CM4. Check that correct device tree overlay is used: on CM4 file system, check that line dtoverlay=uart4 is present in /boot/config.txt. This binds UART4 to a /dev serial link in the Linux operating system. If your application uses other UARTs, check which /dev/ttyAMAX maps to which serial hardware device.</p>
<p>A serial test loopback program allows easy testing from a host PC with a USB to serial adapter connected on the relevant port. The program is located in Utilities/serialTest (see <a class="el" href="utilities.html">Test utilities</a>).</p>
<h2><a class="anchor" id="autotoc_md62"></a>
Check UART signals</h2>
<p>Check that UART frames are sent on the UART. Use a serial test program or <a href="https://unix.stackexchange.com/questions/117037/how-to-send-data-to-a-serial-port-and-see-any-answer">write directly</a> through command line with:</p>
<div class="fragment"><div class="line">echo -ne &#39;\033[2J&#39; &gt; /dev/ttyAMA1</div>
</div><!-- fragment --><p>Read with</p>
<div class="fragment"><div class="line">cat -v &lt; /dev/ttyAMA1</div>
</div><!-- fragment --><p>Or see <a class="el" href="utilities.html">Test utilities</a>.</p>
<p>If no results are obtained, using an oscilloscope or logic analyzer will allow you to check for UART frames manually. If shield sends an answer, you are probably on the right track! See error code definitions in <a href="RM1S3 Host Commands.pdf">ISM3 doc</a> and try to solve the problem.</p>
<p>If shield does not send an answer, baudrate configuration may be wrong. Check config using <a class="el" href="ISM3_config.html">Configuring the ISM3 module</a> as reference.</p>
<h1><a class="anchor" id="autotoc_md63"></a>
Shield configuration</h1>
<p>In gateway mode, check that LEDs IO1 and IO2 light up (default configuration). If they don't, try to restart the program after resetting ISM3 module by pressing the reset button on the left side.</p>
<p>Default configuration LED signals:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">LED   </th><th class="markdownTableHeadNone">Signal   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">SIG_SYNC_OUT   </td><td class="markdownTableBodyNone">Beacon sent    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">SIG_TIMESLOT_OUT   </td><td class="markdownTableBodyNone">TX/RX timeslot    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">SIG_TX_PENDING_OUT   </td><td class="markdownTableBodyNone">Pending transmission   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md64"></a>
Radio communication</h1>
<p>If configuration LEDs light up, radio link may be defective. Check R15-R16 position matches desired antenna setup. Check impedance matching on C21, C23, C24. If using on-shield antenna, check C25 and C26. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
