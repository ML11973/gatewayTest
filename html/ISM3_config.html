<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WPAN Gateway: Configuring the ISM3 module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WPAN Gateway
   </div>
   <div id="projectbrief">A low-power border router</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="ISM3_manual.html">Using the ISM3 module</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Configuring the ISM3 module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md74"></a>
Where is the config?</h2>
<p>Configuration settings are scattered across:</p><ul>
<li><a class="el" href="ism3_8h.html#a469eb4aae8edeaeec0c8970c074552ae">ism_config</a></li>
<li><a class="el" href="ism3_8h.html#a2ec0e0cd46e36a681aea0846b0d216e0">ism_set_sync_mode</a></li>
<li>the configuration_commands array</li>
<li>the <a class="el" href="ism3_8c.html#a734bbab06e1a9fd2e5522db0221ff6e3" title="Hardware serial link to ISM3 baudrate.">BAUDRATE</a> macro</li>
</ul>
<h2><a class="anchor" id="autotoc_md75"></a>
How do I change it?</h2>
<p>Use <a class="el" href="ism3_8h.html#a469eb4aae8edeaeec0c8970c074552ae">ism_config</a> to set address, group, power and beacon ID to sync to.</p>
<p>Use <a class="el" href="ism3_8h.html#a2ec0e0cd46e36a681aea0846b0d216e0">ism_set_sync_mode</a> to set the desired sync mode. See <a class="el" href="ISM3_syncmodes.html">ISM3 sync modes</a> for help on which one does what.</p>
<p>Modify the configuration_commands array's contents to match your liking. Refer to document <a href="RM1S3 Host Commands.pdf">RM1S3 Host Commands</a> for settings information. You can simply look up the command code and the command reference should tell you what the parameter sets.</p>
<p><b>Attention</b>: Changing the baudrate in configuration_commands is not enough on its own. Baudrate must also be changed in <a class="el" href="ism3_8c.html#a734bbab06e1a9fd2e5522db0221ff6e3" title="Hardware serial link to ISM3 baudrate.">BAUDRATE</a> macro for ISM3 baudrate to match host baudrate.</p>
<h2><a class="anchor" id="autotoc_md76"></a>
Default gateway configuration</h2>
<p>A default configuration is available with <a class="el" href="ism3__server_8h.html#a50284f4d21cb70f4b52ef9845af32669">ism_server_init</a>. This configuration is called from <a class="el" href="classwpanManager.html" title="Master handler of radio module and connected nodes.">wpanManager</a> constructor. See implementation for details.</p>
<h3><a class="anchor" id="autotoc_md77"></a>
ism_config</h3>
<p>Call with following parameters:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">address_   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">group_   </td><td class="markdownTableBodyNone">0xFFFFFFFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">power_   </td><td class="markdownTableBodyNone">0x10    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">power_dbm_   </td><td class="markdownTableBodyNone">0x12    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">associated_beacon_id   </td><td class="markdownTableBodyNone">any (default: 0xD322FE7D02D3D117)   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md78"></a>
ism_set_sync_mode</h3>
<p>Set as SM_TX. See <a class="el" href="ISM3_syncmodes.html">ISM3 sync modes</a>.</p>
<h3><a class="anchor" id="autotoc_md79"></a>
configuration_commands array</h3>
<div class="fragment"><div class="line"><span class="keyword">static</span> commands_t configuration_commands = {</div>
<div class="line">    {0x04, CMD_SET_HOST_BAUDRATE,     0x00, 0x4B, 0x00}, <span class="comment">// 19200 in hex notation</span></div>
<div class="line">    {0x01, CMD_GET_FIRMWARE_VERSION},</div>
<div class="line">    {0x01, CMD_GET_HARDWARE_VERSION},</div>
<div class="line">    {0x01, CMD_GET_UNIQUE_DEVICE_ID},</div>
<div class="line">    {0x05, CMD_SET_PATTERN,           0x19, 0x17, 0x10, 0x25},</div>
<div class="line">    {0x01, CMD_GET_PHYS_CHANNELS_PLAN_SIZE},</div>
<div class="line">    {0x02, CMD_SET_TX_RETRY_COUNT,    0x02}, <span class="comment">// Tx retry count = 2</span></div>
<div class="line">    {0x02, CMD_SET_GPIO0_SIGNAL,      0x01}, <span class="comment">// GPIO0 = SIG_SYNC_OUT</span></div>
<div class="line">    {0x02, CMD_SET_GPIO1_SIGNAL,      0x02}, <span class="comment">// GPIO1 = SIG_TIMESLOT_OUT</span></div>
<div class="line">    {0x02, CMD_SET_GPIO2_SIGNAL,      0x04}, <span class="comment">// GPIO2 = SIG_TX_PENDING_OUT</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef NDEBUG</span></div>
<div class="line">    <span class="comment">// interval = 1, missMax = 100, initialTrack = 402ms, trackOn = 202ms, trackOff = 400s</span></div>
<div class="line">    {0x0A, CMD_SET_SYNC_RX,           1, 100, 0x01, 0x92, 0x00, 0xCA, 0x06, 0x1A, 0x80},</div>
<div class="line">    <span class="comment">// {0x0A, CMD_SET_SYNC_RX, 1, 100, 0x01, 0x92, 0x00, 0xCA, 0x00, 0xEA, 0x60}, // 60s</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <span class="comment">// interval = 1, missMax = 100, initialTrack = 402ms, trackOn = 202ms, trackOff = 5s</span></div>
<div class="line">    {0x0A, CMD_SET_SYNC_RX,           1, 100, 0x01, 0x92, 0x00, 0xCA, 0x00, 0x13, 0x88},</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    {0x02, CMD_SET_EVENT_INDICATION,  1}, <span class="comment">// Enable IND_TDMA_STATE_CHANGED</span></div>
<div class="line"> </div>
<div class="line">    {0x02, CMD_SET_RADIO_MODE,        0x00}, <span class="comment">// Stop TDMA</span></div>
<div class="line">    {0x02, CMD_SET_RF_PHY,            0x00}, <span class="comment">// use phy as parameter</span></div>
<div class="line">    {0x02, CMD_SET_ACTIVE_CHANNELS,   0x00}, <span class="comment">// use channels as parameter</span></div>
<div class="line">    <span class="comment">// SERVER CONFIG</span></div>
<div class="line">    {0x02, CMD_SET_DATA_SLOT_COUNT, 0xF}, <span class="comment">// 15 data slots</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Following parameters can change during execution, the numbers of commands should be set in NUMBER_OF_RECONFIGURATION_CMD</span></div>
<div class="line">    {0x02, CMD_SET_SYNC_MODE,         0x00}, <span class="comment">// use sync_mode as parameter</span></div>
<div class="line">    {0x06, CMD_SET_SYNC_RX_LOW_POWER, 0x00, 0x00, 0x00, 0x00, 25}, <span class="comment">// use group as parameter, sync interval = 25</span></div>
<div class="line">    {0x02, CMD_SET_RF_POWER,          0x00}, <span class="comment">// use power as parameter</span></div>
<div class="line">    {0x02, CMD_SET_ADDRESS,           0x00}, <span class="comment">// use address as parameter</span></div>
<div class="line">    {0x05, CMD_SET_GROUP,             0x00, 0x00, 0x00, 0x00}, <span class="comment">// use group as parameter</span></div>
<div class="line">    {0x09, CMD_SET_ASSOCIATED_BEACON_ID, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}, <span class="comment">// use associated_beacon_id as parameter</span></div>
<div class="line">    {0x04, CMD_SET_DATA_SLOT_RANGE_TYPE, 0, 254, 0x01}, <span class="comment">// enable RX on all data slots</span></div>
<div class="line">    {0x03, CMD_SET_DATA_SLOT_TYPE,    0x00, 0x00},</div>
<div class="line">    {0x02, CMD_SET_RADIO_MODE,        0x01}, <span class="comment">// Start TDMA</span></div>
<div class="line">    {0x00}</div>
<div class="line">}; <span class="comment">///&lt; Configuration commands</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md80"></a>
BAUDRATE macro</h3>
<p>This macro defines linux hardware baudrate. It should match baudrate set in configuration_commands. Default value is 19200. It should not be set as a random value since CM4 hardware only supports a few fixed baudrates. See linux_uart_init source in <a class="el" href="buffered__uart_8c.html" title="Driver for UART using circular buffer.">buffered_uart.c</a> and <a href="https://blog.mbedded.ninja/programming/operating-systems/linux/linux-serial-ports-using-c-cpp/#baud-rate">this blog post</a> for additional information about UNIX compliant baudrates.</p>
<h2><a class="anchor" id="autotoc_md81"></a>
What can I change?</h2>
<p>You can change host baudrate, pattern, TX retry count, GPIO signals, Sync RX, RF Phy and channels, data slot count, sync mode, sync rx interval, power, address and group.</p>
<p>To keep gateway functionality, do not change sync mode, address and group. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
