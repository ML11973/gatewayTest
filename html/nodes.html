<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WPAN Gateway: Nodes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WPAN Gateway
   </div>
   <div id="projectbrief">A low-power border router</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="code_overview.html">Codebase overview</a></li><li class="navelem"><a class="el" href="wpanManager_desc.html">WPAN Manager</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Nodes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md39"></a>
Description</h1>
<p>Nodes refer to WPAN clients. They typically provide telemetry data and can control devices. In this software, nodes connected to the gateway are represented as <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a> instances in <a class="el" href="classwpanManager.html" title="Master handler of radio module and connected nodes.">wpanManager</a>.</p>
<p>The <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a> class provides a user with a representation of the available information about the physical node. The class provides a simple way to handle commands coming from and going to Nodes.</p>
<p>This class currently has two children:</p><ul>
<li><a class="el" href="powernodes.html">Power Nodes</a></li>
<li><a class="el" href="datanodes.html">Data Nodes</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md40"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md41"></a>
Instantiation</h2>
<p>Instantiate using any constructor. Using a constructor that does not specify lease duration or setting lease duration to zero will create a statically-addressed <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a>. Manually changing address and group is not allowed once instantiated, so it is important to set the correct values on constructor call.</p>
<h2><a class="anchor" id="autotoc_md42"></a>
Sending commands</h2>
<p>Use any function starting with net_ to issue a <a class="el" href="net_protocol.html">Network protocol</a> command. Class will handle frame building and behavior on answer, provided its <a class="el" href="classNode.html#ad0d02e76231afbb5d0ea7fe504122238" title="Master RX handler, calls corresponding protocol handler.">Node::rxCallback</a> is called with the relevant frames.</p>
<p>Protocol commands that require an answer typically set a callback flag that is updated on answer reception through <a class="el" href="classNode.html#ad0d02e76231afbb5d0ea7fe504122238" title="Master RX handler, calls corresponding protocol handler.">Node::rxCallback</a>. Failure to call handler will cause the command to time out.</p>
<p>Protocol commands can be blocking or non-blocking depending on argument timeout value. If timeout is 0, command is non-blocking. Status can be manually checked using a <a class="el" href="classNode.html#a8ba73358ec29eca790ba4f084c8059f7" title="Get NETWORK_PING command status.">Node::pingStatus</a>-style function.</p>
<h2><a class="anchor" id="autotoc_md43"></a>
Debugging</h2>
<p><a class="el" href="wpan_8h.html" title="Definitions for WPAN protocols.">wpan.h</a> provides two DEBUG macros for this class. Uncomment #DEBUG_RXTX to show all incoming and outgoing frames. Uncomment #DEBUG_NET to show only <a class="el" href="net_protocol.html">Network protocol</a> frames.</p>
<h1><a class="anchor" id="autotoc_md44"></a>
Implementation details</h1>
<h2><a class="anchor" id="autotoc_md45"></a>
Frame IO</h2>
<p>The <a class="el" href="classNode.html#a1ad7b44ee7e93305b4d8f237d586a9c2" title="Send buffer to Node using unicast frame.">Node::tx</a> method is a wrapper for the radio driver's ism_tx function. It transmits a buffer to the <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a> address attribute.</p>
<p>The <a class="el" href="classNode.html#abab470d3f0bf634439ab9e17587e4a8e" title="TX frame expecting arg flag to be raised, with timeout.">Node::txTimeout</a> method allows transmission of a buffer and expects an answer flag to be raised on answer within the specified timeout. The method resets the flag and polls it for a true value. If the flag remains false until the timeout, the method returns.</p>
<p>The <a class="el" href="classNode.html#ad0d02e76231afbb5d0ea7fe504122238" title="Master RX handler, calls corresponding protocol handler.">Node::rxCallback</a> method assumes the packet it receives is coming from the remote node with address matching the <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a> address attribute. A dispatcher function has to be used to ensure the proper <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a> instance receives data from its matching remote node.</p>
<p>The <a class="el" href="classwpanManager.html" title="Master handler of radio module and connected nodes.">wpanManager</a> class provides a rxHandler that dispatches packets to destination <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a> instance <a class="el" href="classNode.html#ad0d02e76231afbb5d0ea7fe504122238" title="Master RX handler, calls corresponding protocol handler.">Node::rxCallback</a>. See below an example sequence diagram of data protocol reception.</p>
<div class="image">
<img src="seq_rx.png" alt=""/>
<div class="caption">
Data protocol RX sequence</div></div>
 <h2><a class="anchor" id="autotoc_md46"></a>
Command functions</h2>
<p>Methods starting with net_, such as <a class="el" href="classNode.html#aace7f79d25df123adaf1497ed29e67e8" title="Get node UID.">Node::net_getUid</a>, are wrappers to send the corresponding command to the remote node. They also reset the corresponding callback flag. Using these methods is the safest and most convenient way to send <a class="el" href="net_protocol.html">Network protocol</a>.</p>
<p><b>Do not confuse network commands such as <a class="el" href="classNode.html#aace7f79d25df123adaf1497ed29e67e8" title="Get node UID.">Node::net_getUid</a> with getters such as <a class="el" href="classNode.html#a1acfbaf594e2890695329c089fc26341" title="Get unique device id.">Node::getUid</a>!</b></p>
<h2><a class="anchor" id="autotoc_md47"></a>
Callback flags</h2>
<p>These flags signal whether an answer to a network command requiring confirmation has been received. They are reset by their respective network command method and set upon confirmation reception in <a class="el" href="classNode.html#a951eb2ae4f3bb1958330e08bebebae4d" title="Network protocol RX handler.">Node::netCmdCallback</a>.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Class hierarchy</h2>
<p>The <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a> class is the parent of <a class="el" href="classDataNode.html" title="Datagram-capable node. See Data Nodes.">DataNode</a> and <a class="el" href="classPowerNode.html" title="Reprensentation of a distant power node. See Power Nodes page for details.">PowerNode</a>. It handles the common <a class="el" href="net_protocol.html">Network protocol</a>.</p>
<p><b>This class and its children are runtime-polymorphic.</b> This means that accessing a child class instance through a parent class pointer is the same as accessing the child class instance through a child class pointer. Changing a <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a>'s behavior requires reinstantiation through the child class' relevant constructor.</p>
<h2><a class="anchor" id="autotoc_md49"></a>
Polymorphic behavior</h2>
<p>This means that a <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a> or child of <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a> will have its virtual methods bound at runtime on instance creation. In practice, this means that a Node-type pointer to a child class will execute the child class virtual methods, while a static method bind would have it execute the pointer-type methods. <a href="https://www.geeksforgeeks.org/virtual-function-cpp/">This article will explain it better</a></p>
<p>For example, calling <a class="el" href="classNode.html#adbc3a6c825a398107cf5ce2e691bff65" title="Application protocol RX handler.">Node::appCmdCallback</a> from a Node-type pointer to a <a class="el" href="classPowerNode.html" title="Reprensentation of a distant power node. See Power Nodes page for details.">PowerNode</a> instance will execute <a class="el" href="classPowerNode.html#a9f264e4192813f77fa715bd545ea56cf" title="Handles application command.">PowerNode::appCmdCallback</a> instead of <a class="el" href="classNode.html#adbc3a6c825a398107cf5ce2e691bff65" title="Application protocol RX handler.">Node::appCmdCallback</a>.</p>
<p>It is therefore impossible to change an instance's behavior by using a different type pointer. Changing a <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a> to <a class="el" href="classPowerNode.html" title="Reprensentation of a distant power node. See Power Nodes page for details.">PowerNode</a> type requires destruction of the <a class="el" href="classNode.html" title="Reprensentation of a distant node. See Nodes page for details.">Node</a> instance and creation of a <a class="el" href="classPowerNode.html" title="Reprensentation of a distant power node. See Power Nodes page for details.">PowerNode</a> instance. Fortunately, this is covered by the relevant constructor in child classes. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
